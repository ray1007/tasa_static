(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{111:function(e,t,n){e.exports=n(281)},116:function(e,t,n){},137:function(e,t,n){},139:function(e,t,n){},281:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(17),s=n.n(i),r=(n(116),n(22)),l=n(23),c=n(26),d=n(24),h=n(25),u=n(14),m=n(38),k=n.n(m),p=(n(137),n(104)),v=n.n(p),w=n(106),g=n.n(w),f=n(19),b=n.n(f),E=n(107),S=n.n(E),T=n(109),y=n.n(T),C=n(108),O=n.n(C),j=(n(139),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleDialogOpen=n.handleDialogOpen.bind(Object(u.a)(Object(u.a)(n))),n.handleDialogClose=n.handleDialogClose.bind(Object(u.a)(Object(u.a)(n))),n.state={dialogOpen:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleDialogOpen",value:function(){this.setState({dialogOpen:!0})}},{key:"handleDialogClose",value:function(){this.setState({dialogOpen:!1})}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(v.a,{position:"static"},o.a.createElement(g.a,null,o.a.createElement(b.a,{className:"appbarSpace",variant:"h6",color:"inherit"},"Annotator App"),o.a.createElement(S.a,{color:"inherit",onClick:this.handleDialogOpen},"Show Instructions"))),o.a.createElement(O.a,{open:this.state.dialogOpen,onClose:this.handleDialogClose,"aria-labelledby":"simple-dialog-title"},o.a.createElement(y.a,null,"Instructions"),o.a.createElement(b.a,{className:"dialogText"},"Use key A/D or left/right to move along source sentence. ",o.a.createElement("br",null),"Use mouse click to toggle selection of each target sentence token. ",o.a.createElement("br",null),'Click the "Re-tokenize" button to modify tokenization. A textfield will show up and each individual token should be put in a line.')))}}]),t}(a.PureComponent)),L=n(28),x=n.n(L),z=n(30),I=n.n(z),N=n(20),M=n.n(N),P=n(110),D=n.n(P),A=(n(94),n(29)),_=n.n(A),J=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).keyHandling=function(e){var t=-1;switch(e.code){case"KeyA":case"ArrowLeft":for(t=n.props.currentPos-1;t>=0&&!n.props.headInds.has(t);)t-=1;n.props.moveSrcPos(t);break;case"KeyD":case"ArrowRight":for(t=n.props.currentPos+1;t<n.props.tokens.length&&!n.props.headInds.has(t);)t+=1;n.props.moveSrcPos(t)}},n.handleEnterEditMode=function(){window.removeEventListener("keyup",n.keyHandling),n.setState({editMode:!0,tokenJoinedText:n.props.tokens.join("\n")})},n.handleLeaveEditMode=function(){window.addEventListener("keyup",n.keyHandling),n.setState({editMode:!1});var e=document.getElementById("tokensTextField").value.split("\n");n.props.changeTokens(e)},n.state={editMode:!1,tokenJoinedText:""},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("keyup",this.keyHandling)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keyup",this.keyHandling)}},{key:"render",value:function(){return this.state.editMode?this.renderEditMode():this.renderNormalMode()}},{key:"renderNormalMode",value:function(){var e=this;return o.a.createElement(M.a,{className:"panel",elevation:4},o.a.createElement(I.a,{container:!0,spacing:16},o.a.createElement(I.a,{item:!0,xs:11},this.props.tokens.map(function(t,n){return e.props.headInds.has(n)?n===e.props.currentPos?o.a.createElement(x.a,{className:"token",label:t,color:"primary"}):o.a.createElement(x.a,{className:"token",label:t,style:{fontWeight:"bold",backgroundColor:e.props.colors[n]}}):o.a.createElement(x.a,{className:"token",label:t,style:{color:"#808080",backgroundColor:e.props.colors[n]}})})),o.a.createElement(I.a,{item:!0,xs:1},this.props.enableRetokenize?o.a.createElement(_.a,{variant:"contained",color:"primary",onClick:this.handleEnterEditMode},"Re-tokenize"):null)),o.a.createElement("div",{id:"test"}))}},{key:"renderEditMode",value:function(){return o.a.createElement(M.a,{className:"panel",elevation:4},o.a.createElement(I.a,{container:!0,spacing:16},o.a.createElement(I.a,{item:!0,xs:11},o.a.createElement(b.a,{variant:"headline",component:"h3"},"Source Language"),o.a.createElement(b.a,{component:"p"},"Edit source sentence tokenization. Each line represents a single token.")),o.a.createElement(I.a,{item:!0,xs:1},o.a.createElement(_.a,{variant:"contained",color:"primary",onClick:this.handleLeaveEditMode},"Save"))),o.a.createElement("div",{className:"divider"}),o.a.createElement(D.a,{id:"tokensTextField",label:"Edit tokens",multiline:!0,fullWidth:!0,defaultValue:this.state.tokenJoinedText,margin:"normal",variant:"outlined"}))}}]),t}(a.PureComponent);var R=n(27),H=n.n(R),U=n(61),F=n.n(U),W=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleEnterEditMode=function(){n.setState({editMode:!0,tokenJoinedText:n.props.tokens.join("\n")})},n.handleLeaveEditMode=function(){n.setState({editMode:!1});var e=document.getElementById("tokensTextField").value.split("\n");n.props.changeTokens(e)},n.state={editMode:!1,tokenJoinedText:""},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleClick",value:function(e){var t=this;return function(){t.props.toggleSelectionAt(e),t.forceUpdate()}}},{key:"render",value:function(){return this.state.editMode?this.renderEditMode():this.renderNormalMode()}},{key:"renderNormalMode",value:function(){var e=this;return o.a.createElement(M.a,{className:"panel",elevation:4},o.a.createElement(H.a,{container:!0,spacing:16},o.a.createElement(H.a,{item:!0,xs:11},this.props.tokens.map(function(t,n){return e.props.headInds.has(n)?e.props.selection[n]?o.a.createElement(x.a,{className:"token",label:t,onClick:e.handleClick(n),color:"primary"}):o.a.createElement(x.a,{className:"token",label:t,style:{fontWeight:"bold",backgroundColor:e.props.colors[n]},onClick:e.handleClick(n)}):o.a.createElement(x.a,{className:"token",label:t,style:{color:"#808080",backgroundColor:e.props.colors[n]}})})),o.a.createElement(H.a,{item:!0,xs:1},this.props.enableRetokenize?o.a.createElement(_.a,{variant:"contained",color:"primary",onClick:this.handleEnterEditMode},"Re-tokenize"):null)))}},{key:"renderEditMode",value:function(){return o.a.createElement(M.a,{className:"panel",elevation:4},o.a.createElement(H.a,{container:!0,spacing:16},o.a.createElement(H.a,{item:!0,xs:11},o.a.createElement(b.a,{variant:"headline",component:"h3"},"Source Language"),o.a.createElement(b.a,{component:"p"},"Edit source sentence tokenization. Each line represents a single token.")),o.a.createElement(H.a,{item:!0,xs:1},o.a.createElement(_.a,{variant:"contained",color:"primary",onClick:this.handleLeaveEditMode},"Save"))),o.a.createElement("div",{className:"divider"}),o.a.createElement(F.a,{id:"tokensTextField",label:"Edit tokens",multiline:!0,fullWidth:!0,defaultValue:this.state.tokenJoinedText,margin:"normal",variant:"outlined"}))}}]),t}(a.PureComponent),q=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).handleNextData=n.handleNextData.bind(Object(u.a)(Object(u.a)(n))),n.handlePrevData=n.handlePrevData.bind(Object(u.a)(Object(u.a)(n))),n.handleSrcPosChange=n.handleSrcPosChange.bind(Object(u.a)(Object(u.a)(n))),n.handleToggleSelectionAt=n.handleToggleSelectionAt.bind(Object(u.a)(Object(u.a)(n))),n.handleChangeSrcTokens=n.handleChangeSrcTokens.bind(Object(u.a)(Object(u.a)(n))),n.handleChangeTarTokens=n.handleChangeTarTokens.bind(Object(u.a)(Object(u.a)(n))),n.handleSubmit=n.handleSubmit.bind(Object(u.a)(Object(u.a)(n))),n.enComm={},n.zhComm={},console.log("TEST TEST TEST "),n.state={dataIdx:2,totalData:20,srcTokens:[],tarTokens:[],selections:[[]],srcPos:0,currentSelection:[],zhEnableRetokenize:!0,enEnableRetokenize:!0,srcColors:[],tarColors:[],srcHeadInds:[],tarHeadInds:[]},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillMount",value:function(){var e=document.querySelector("#enCommInput");e&&(e.style.display="none"),(e=document.querySelector("#zhCommInput"))&&(e.style.display="none"),(e=document.querySelector("#alignmentInput"))&&(e.style.display="none");var t=document.querySelector("#hiddenSubmit");if(t){t.style.display="none";var n=new window.Communication;n.initFromTJSONProtocolObject(window.zh_comm);var a=n.sectionList[0].sentenceList[0].tokenization.tokenList.tokenList,o=a.map(function(e){return e.text});this.zhComm=n,this.setState({tarTokens:o}),(n=new window.Communication).initFromTJSONProtocolObject(window.en_comm);for(var i=(a=n.sectionList[0].sentenceList[0].tokenization.tokenList.tokenList).map(function(e){return e.text}),s=window.aln_comm,r=0;r<s.length;r++)for(var l=0;l<s[r].length;l++)s[r][l]="true"==s[r][l];var c=1===window.zh_enable_retokenize,d=1===window.en_enable_retokenize;console.log("spans",window.src_spans);for(var h=window.src_spans,u=window.tar_spans,m=67,k=[],p=0,v=0;v<h.length;v++){for(var w=h[v][0],g=h[v][1],f=p;f<w;f++)k.push("hsl(0,0%,87%)");for(var b=w;b<g;b++)k.push("hsl(".concat(m,",50%,75%)"));p=g,m=(m+67)%360}for(;p<i.length;p++)k.push("hsl(0,0%,87%)");var E=[];p=0;for(var S=0;S<u.length;S++){for(var T=u[S][0],y=u[S][1],C=p;C<T;C++)E.push("hsl(0,0%,87%)");for(var O=T;O<y;O++)E.push("hsl(".concat(m,",50%,75%)"));p=y,m=(m+67)%360}for(;p<o.length;p++)E.push("hsl(0,0%,87%)");var j=window.src_head_inds,L=window.tar_head_inds;this.enComm=n,this.setState({srcTokens:i,selections:s,zhEnableRetokenize:c,enEnableRetokenize:d,srcHeadInds:new Set(j),tarHeadInds:new Set(L),srcColors:k,tarColors:E})}else this.fetchCommunicationAndUpdateState(this.state.dataIdx)}},{key:"fetchCommunicationAndUpdateState",value:function(e){var t=this,n="concrete_files/en.".concat(e,".comm.json"),a="concrete_files/zh.".concat(e,".comm.json");k.a.get(a).then(function(e){var a=new window.Communication;a.initFromTJSONProtocolObject(e.data);var o=a.sectionList[0].sentenceList[0].tokenization.tokenList.tokenList,i=o.map(function(e){return e.text});return t.zhComm=a,t.setState({tarTokens:i,tarHeadInds:new Set(o.map(function(e,t){return t}))}),k.a.get(n)}).then(function(e){var n=new window.Communication;n.initFromTJSONProtocolObject(e.data);var a=n.sectionList[0].sentenceList[0].tokenization.tokenList.tokenList,o=a.map(function(e){return e.text}),i=t.state.tarTokens,s=o.map(function(e){return i.map(function(e){return!1})}),r=n;console.log(JSON.stringify(r)),t.enComm=n;for(var l=[],c=67,d=0;d<o.length;d++)l.push("hsl(".concat(c,",50%,85%)")),c=(c+67)%360;var h=[];for(d=0;d<i.length;d++)h.push("hsl(".concat(c,",30%,85%)")),c=(c+67)%360;t.setState({srcTokens:o,srcHeadInds:new Set(a.map(function(e,t){return 1})),selections:s,srcColors:l,tarColors:h})})}},{key:"handleSrcPosChange",value:function(e){0<=e&&e<this.state.srcTokens.length&&this.setState({srcPos:e})}},{key:"handleToggleSelectionAt",value:function(e){var t=this.state.selections,n=t[this.state.srcPos];n[e]=!0!==n[e],t[this.state.srcPos]=n,this.setState({selections:t})}},{key:"handleChangeSrcTokens",value:function(e){var t=this,n=new window.Tokenization;n.kind=window.TokenizationKind.TOKEN_LIST,n.metadata=new window.AnnotationMetadata,n.metadata.timestamp=Math.floor(Date.now()/1e3),n.metadata.tool="annotation app with concrete.js",n.tokenList=new window.TokenList,n.tokenList.tokenList=[],n.uuid=window.concrete.util.generateUUID();var a="",o=0;for(var i in e){var s=new window.Token;s.text=e[i],a+=e[i]+" ";var r=new window.TextSpan;r.start=o,r.end=o+e[i].length,s.textSpan=r,s.tokenIndex=i,n.tokenList.tokenList.push(s),o=r.end+1}this.enComm.sectionList[0].sentenceList[0].tokenization=n,this.enComm.text=a;var l=e.map(function(e){return t.state.tarTokens.map(function(e){return!1})});this.setState({srcTokens:e,selections:l})}},{key:"handleChangeTarTokens",value:function(e){var t=new window.Tokenization;t.kind=window.TokenizationKind.TOKEN_LIST,t.metadata=new window.AnnotationMetadata,t.metadata.timestamp=Math.floor(Date.now()/1e3),t.metadata.tool="annotation app with concrete.js",t.tokenList=new window.TokenList,t.tokenList.tokenList=[],t.uuid=window.concrete.util.generateUUID();var n="",a=0;for(var o in e){var i=new window.Token;i.text=e[o],n+=e[o]+" ";var s=new window.TextSpan;s.start=a,s.end=a+e[o].length,i.textSpan=s,i.tokenIndex=o,t.tokenList.tokenList.push(i),a=s.end+1}this.zhComm.sectionList[0].sentenceList[0].tokenization=t,this.zhComm.text=n;var r=this.state.tarTokens.map(function(t){return e.map(function(e){return!1})});this.setState({tarTokens:e,selections:r})}},{key:"handlePrevData",value:function(){var e=this.state.dataIdx;e>1&&(this.setState({dataIdx:e-1}),this.fetchCommunicationAndUpdateState(e-1))}},{key:"handleNextData",value:function(){var e=this.state.dataIdx;e<this.state.totalData&&(this.setState({dataIdx:e+1}),this.fetchCommunicationAndUpdateState(e+1))}},{key:"handleSubmit",value:function(){var e=document.querySelector("#enCommInput");e&&(e.value=this.enComm.toTJSONProtocolString()),(e=document.querySelector("#zhCommInput"))&&(e.value=this.zhComm.toTJSONProtocolString()),(e=document.querySelector("#alignmentInput"))&&(e.value=JSON.stringify(this.state.selections))}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(j,null),o.a.createElement(J,{tokens:this.state.srcTokens,currentPos:this.state.srcPos,headInds:this.state.srcHeadInds,colors:this.state.srcColors,enableRetokenize:this.state.enEnableRetokenize,moveSrcPos:this.handleSrcPosChange,changeTokens:this.handleChangeSrcTokens}),o.a.createElement(W,{tokens:this.state.tarTokens,headInds:this.state.tarHeadInds,colors:this.state.tarColors,selection:this.state.selections[this.state.srcPos],enableRetokenize:this.state.zhEnableRetokenize,toggleSelectionAt:this.handleToggleSelectionAt,changeTokens:this.handleChangeTarTokens}),o.a.createElement("input",{className:"submit",onClick:this.handleSubmit,type:"submit",value:"Submit"}))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},94:function(e,t,n){}},[[111,2,1]]]);
//# sourceMappingURL=main.1a594db1.chunk.js.map